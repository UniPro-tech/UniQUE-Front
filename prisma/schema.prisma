generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model access_tokens {
  id          Int         @id @default(autoincrement())
  hash        String?     @db.VarChar(255)
  type        String?     @db.VarChar(255)
  scope       String?     @db.VarChar(255)
  issued_at   DateTime?   @db.Timestamp(0)
  exp         DateTime?   @db.Timestamp(0)
  client_id   Int?
  user_id     Int?
  revoked     Boolean?
  oidc_tokens oidc_tokens @relation(fields: [id], references: [access_token_id], onDelete: NoAction, onUpdate: NoAction, map: "access_tokens_ibfk_1")
}

model apps {
  id            String          @id @default("uuid()") @db.VarChar(255)
  client_id     String?         @unique(map: "client_id") @db.VarChar(255)
  client_secret String?         @db.VarChar(255)
  name          String?         @db.VarChar(255)
  created_at    DateTime?       @default(now()) @db.Timestamp(0)
  is_enable     Boolean?
  auths         auths[]
  member_app    member_app[]
  redirect_uris redirect_uris[]
}

model auths {
  id                  Int                   @id @default(autoincrement())
  auth_user_id        Int?
  app_id              String?               @db.VarChar(255)
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  is_enable           Boolean?
  users               users?                @relation(fields: [auth_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auths_ibfk_1")
  apps                apps?                 @relation(fields: [app_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auths_ibfk_2")
  oidc_authorizations oidc_authorizations[]

  @@index([app_id], map: "app_id")
  @@index([auth_user_id], map: "auth_user_id")
}

model code {
  id                                                                  Int                  @id @default(autoincrement())
  oidc_authorization_id                                               Int?
  token                                                               String?              @db.VarChar(255)
  created_at                                                          DateTime?            @default(now()) @db.Timestamp(0)
  exp                                                                 DateTime?            @db.Timestamp(0)
  is_enable                                                           Boolean?
  oidc_authorizations_code_oidc_authorization_idTooidc_authorizations oidc_authorizations? @relation("code_oidc_authorization_idTooidc_authorizations", fields: [oidc_authorization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "code_ibfk_1")
  oidc_authorizations_oidc_authorizations_code_idTocode               oidc_authorizations? @relation("oidc_authorizations_code_idTocode")

  @@index([oidc_authorization_id], map: "oidc_authorization_id")
}

model consents {
  id                  Int                   @id @default(autoincrement())
  scope               String?               @db.VarChar(255)
  is_enable           Boolean?
  oidc_authorizations oidc_authorizations[]
}

model discords {
  id         Int     @id @default(autoincrement())
  discord_id String  @unique(map: "discord_id") @db.VarChar(255)
  member     String  @db.VarChar(255)
  members    members @relation(fields: [member], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "discords_ibfk_1")

  @@index([member], map: "member")
}

model member_app {
  id      Int      @id @default(autoincrement())
  app     String?  @db.VarChar(255)
  member  String?  @db.VarChar(255)
  apps    apps?    @relation(fields: [app], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "member_app_ibfk_1")
  members members? @relation(fields: [member], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "member_app_ibfk_2")

  @@index([app], map: "app")
  @@index([member], map: "member")
}

model member_role {
  id      Int     @id @default(autoincrement())
  member  String  @db.VarChar(255)
  role    String  @db.VarChar(255)
  members members @relation(fields: [member], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "member_role_ibfk_1")
  roles   roles   @relation(fields: [role], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "member_role_ibfk_2")

  @@index([member], map: "member")
  @@index([role], map: "role")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model members {
  id                             String        @id @default("uuid()") @db.VarChar(255)
  name                           String        @db.VarChar(255)
  email                          String?       @unique(map: "email") @db.VarChar(255)
  external_email                 String        @db.VarChar(255)
  custom_id                      String        @unique(map: "custom_id") @db.VarChar(255)
  created_at                     DateTime      @default(now()) @db.Timestamp(0)
  updated_at                     DateTime?     @db.Timestamp(0)
  joined_at                      DateTime?     @db.Timestamp(0)
  is_enable                      Boolean       @default(true)
  period                         String        @db.VarChar(255)
  system                         Boolean       @default(false)
  discords                       discords[]
  member_app                     member_app[]
  member_role                    member_role[]
  users_users_custom_idTomembers users?        @relation("users_custom_idTomembers")
  users_users_emailTomembers     users?        @relation("users_emailTomembers")
}

model oidc_authorizations {
  id                                                   Int          @id @default(autoincrement())
  auth_id                                              Int?
  code_id                                              Int?         @unique(map: "code_id")
  consent_id                                           Int?
  created_at                                           DateTime?    @default(now()) @db.Timestamp(0)
  code_code_oidc_authorization_idTooidc_authorizations code[]       @relation("code_oidc_authorization_idTooidc_authorizations")
  auths                                                auths?       @relation(fields: [auth_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_authorizations_ibfk_1")
  consents                                             consents?    @relation(fields: [consent_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_authorizations_ibfk_2")
  code_oidc_authorizations_code_idTocode               code?        @relation("oidc_authorizations_code_idTocode", fields: [code_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_authorizations_ibfk_3")
  oidc_tokens                                          oidc_tokens?

  @@index([auth_id], map: "auth_id")
  @@index([consent_id], map: "consent_id")
}

model oidc_tokens {
  id                    Int                  @id @default(autoincrement())
  oidc_authorization_id Int?                 @unique(map: "oidc_authorization_id")
  access_token_id       Int?                 @unique(map: "access_token_id")
  refresh_token_id      Int?                 @unique(map: "refresh_token_id")
  is_enable             Boolean?
  access_tokens         access_tokens?
  oidc_authorizations   oidc_authorizations? @relation(fields: [oidc_authorization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_tokens_ibfk_1")
  refresh_tokens        refresh_tokens?
}

model redirect_uris {
  id         Int       @id @default(autoincrement())
  app_id     String?   @db.VarChar(255)
  uri        String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  apps       apps?     @relation(fields: [app_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "redirect_uris_ibfk_1")

  @@index([app_id], map: "app_id")
}

model refresh_tokens {
  id          Int         @id @default(autoincrement())
  hash        String?     @db.VarChar(255)
  type        String?     @db.VarChar(255)
  scope       String?     @db.VarChar(255)
  issued_at   DateTime?   @db.Timestamp(0)
  exp         DateTime?   @db.Timestamp(0)
  client_id   Int?
  user_id     Int?
  revoked     Boolean?
  oidc_tokens oidc_tokens @relation(fields: [id], references: [refresh_token_id], onDelete: NoAction, onUpdate: NoAction, map: "refresh_tokens_ibfk_1")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model roles {
  id          String        @id @default("uuid()") @db.VarChar(255)
  custom_id   String?       @unique(map: "custom_id") @db.VarChar(255)
  permissions Int           @default(0)
  created_at  DateTime      @default(now()) @db.Timestamp(0)
  updated_at  DateTime?     @db.Timestamp(0)
  is_enable   Boolean       @default(true)
  system      Boolean       @default(false)
  member_role member_role[]
}

model sessions {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  ip_address String?   @db.VarChar(255)
  user_agent String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  is_enable  Boolean?
  users      users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "sessions_ibfk_1")

  @@index([user_id], map: "user_id")
}

model users {
  id                               Int        @id @default(autoincrement())
  custom_id                        String?    @unique(map: "custom_id") @db.VarChar(255)
  created_at                       DateTime?  @default(now()) @db.Timestamp(0)
  password_hash                    String     @db.VarChar(255)
  email                            String?    @unique(map: "email") @db.VarChar(255)
  is_enable                        Boolean?
  auths                            auths[]
  sessions                         sessions[]
  members_users_custom_idTomembers members?   @relation("users_custom_idTomembers", fields: [custom_id], references: [custom_id], onDelete: NoAction, onUpdate: NoAction, map: "users_ibfk_1")
  members_users_emailTomembers     members?   @relation("users_emailTomembers", fields: [email], references: [email], onDelete: NoAction, onUpdate: NoAction, map: "users_ibfk_2")
}
