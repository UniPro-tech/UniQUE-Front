generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model access_tokens {
  id         Int         @id @default(autoincrement())
  hash       String      @db.VarChar(255)
  type       String      @db.VarChar(255)
  scope      String      @db.VarChar(255)
  issued_at  DateTime    @db.Timestamp(0)
  exp        DateTime    @db.Timestamp(0)
  client_id  String      @db.VarChar(255)
  user_id    String      @db.VarChar(255)
  revoked    Boolean     @default(false)
  token_sets token_sets?
}

model apps {
  id            String          @id @db.VarChar(255)
  client_id     String          @unique(map: "client_id") @db.VarChar(255)
  aud           String          @unique(map: "aud") @db.VarChar(255)
  client_secret String          @db.VarChar(255)
  name          String          @db.VarChar(255)
  created_at    DateTime?       @default(now()) @db.Timestamp(0)
  is_enable     Boolean         @default(true)
  auths         auths[]
  redirect_uris redirect_uris[]
  user_app      user_app[]
}

model auths {
  id                  Int                   @id @default(autoincrement())
  auth_user_id        String                @db.VarChar(255)
  app_id              String                @db.VarChar(255)
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  is_enable           Boolean               @default(true)
  users               users                 @relation(fields: [auth_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auths_ibfk_1")
  apps                apps                  @relation(fields: [app_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auths_ibfk_2")
  oidc_authorizations oidc_authorizations[]

  @@index([app_id], map: "app_id")
  @@index([auth_user_id], map: "auth_user_id")
}

model code {
  id                                                    Int                  @id @default(autoincrement())
  token                                                 String               @unique(map: "token") @db.VarChar(255)
  created_at                                            DateTime?            @default(now()) @db.Timestamp(0)
  exp                                                   DateTime?            @db.Timestamp(0)
  is_enable                                             Boolean              @default(true)
  oidc_authorizations_oidc_authorizations_code_idTocode oidc_authorizations? @relation("oidc_authorizations_code_idTocode")
}

model consents {
  id                  Int                   @id @default(autoincrement())
  scope               String?               @db.VarChar(255)
  is_enable           Boolean?
  oidc_authorizations oidc_authorizations[]
}

model discords {
  id         Int    @id @default(autoincrement())
  discord_id String @unique(map: "discord_id") @db.VarChar(255)
  user_id    String @db.VarChar(255)
  users      users  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "discords_ibfk_1")

  @@index([user_id], map: "user_id")
}

model oidc_authorizations {
  id                                     Int         @id @default(autoincrement())
  auth_id                                Int
  code_id                                Int         @unique(map: "code_id")
  consent_id                             Int
  created_at                             DateTime?   @default(now()) @db.Timestamp(0)
  auths                                  auths       @relation(fields: [auth_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_authorizations_ibfk_1")
  consents                               consents    @relation(fields: [consent_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_authorizations_ibfk_2")
  code_oidc_authorizations_code_idTocode code        @relation("oidc_authorizations_code_idTocode", fields: [code_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "oidc_authorizations_ibfk_3")
  token_sets                             token_sets?

  @@index([auth_id], map: "auth_id")
  @@index([consent_id], map: "consent_id")
}

model redirect_uris {
  id         Int       @id @default(autoincrement())
  app_id     String    @db.VarChar(255)
  uri        String    @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  apps       apps      @relation(fields: [app_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "redirect_uris_ibfk_1")

  @@index([app_id], map: "app_id")
}

model refresh_tokens {
  id         Int         @id @default(autoincrement())
  hash       String      @db.VarChar(255)
  type       String      @db.VarChar(255)
  issued_at  DateTime    @db.Timestamp(0)
  exp        DateTime    @db.Timestamp(0)
  client_id  String      @db.VarChar(255)
  user_id    String      @db.VarChar(255)
  revoked    Boolean     @default(false)
  token_sets token_sets?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model roles {
  id          String      @id @db.VarChar(255)
  custom_id   String?     @unique(map: "custom_id") @db.VarChar(255)
  permissions Int         @default(0)
  created_at  DateTime    @default(now()) @db.Timestamp(0)
  updated_at  DateTime?   @db.Timestamp(0)
  is_enable   Boolean     @default(true)
  system      Boolean     @default(false)
  user_role   user_role[]
}

model sessions {
  id         String    @id @db.VarChar(255)
  user_id    String    @db.VarChar(255)
  ip_address String    @db.VarChar(255)
  user_agent String    @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  is_enable  Boolean   @default(true)
  users      users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "sessions_ibfk_1")

  @@index([user_id], map: "user_id")
}

model users {
  id             String      @id @db.VarChar(255)
  custom_id      String?     @unique(map: "custom_id") @db.VarChar(255)
  name           String      @db.VarChar(255)
  password_hash  String?     @db.VarChar(255)
  email          String?     @unique(map: "email") @db.VarChar(255)
  external_email String      @db.VarChar(255)
  period         String      @db.VarChar(255)
  joined_at      DateTime?   @db.DateTime(0)
  is_system      Boolean     @default(false)
  created_at     DateTime?   @default(now()) @db.DateTime(0)
  updated_at     DateTime?   @db.DateTime(0)
  is_enable      Boolean?    @default(true)
  auths          auths[]
  discords       discords[]
  sessions       sessions[]
  user_app       user_app[]
  user_role      user_role[]

  @@index([custom_id], map: "idx_users_custom_id")
}

model user_app {
  id      Int     @id @default(autoincrement())
  app_id  String? @db.VarChar(255)
  user_id String? @db.VarChar(255)
  apps    apps?   @relation(fields: [app_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_app_ibfk_1")
  users   users?  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_app_ibfk_2")

  @@index([app_id], map: "app_id")
  @@index([user_id], map: "user_id")
}

model user_role {
  id      Int    @id @default(autoincrement())
  user_id String @db.VarChar(255)
  role_id String @db.VarChar(255)
  users   users  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_role_ibfk_1")
  roles   roles  @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_role_ibfk_2")

  @@index([role_id], map: "role_id")
  @@index([user_id], map: "user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model id_tokens {
  id        Int       @id @default(autoincrement())
  hash      String    @db.VarChar(255)
  type      String    @db.VarChar(255)
  scope     String    @db.VarChar(255)
  issued_at DateTime  @db.Timestamp(0)
  exp       DateTime  @db.Timestamp(0)
  client_id String    @db.VarChar(255)
  aud       String    @db.VarChar(255)
  nonce     String?   @db.VarChar(255)
  auth_time DateTime? @db.Timestamp(0)
  acr       String?   @db.VarChar(255)
  amr       String?   @db.VarChar(255)
  jti       String    @unique(map: "jti") @db.VarChar(64)
  user_id   String    @db.VarChar(255)
  revoked   Boolean   @default(false)
}

model token_sets {
  id                    Int                 @id @default(autoincrement())
  oidc_authorization_id Int                 @unique(map: "oidc_authorization_id")
  access_token_id       Int                 @unique(map: "access_token_id")
  refresh_token_id      Int                 @unique(map: "refresh_token_id")
  is_enable             Boolean             @default(true)
  access_tokens         access_tokens       @relation(fields: [access_token_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "token_sets_ibfk_1")
  refresh_tokens        refresh_tokens      @relation(fields: [refresh_token_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "token_sets_ibfk_2")
  oidc_authorizations   oidc_authorizations @relation(fields: [oidc_authorization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "token_sets_ibfk_3")
}
